name: Lotus Number Transformation Actions
description: Test various number transformation actions (add, multiply, subtract, etc.)

steps:
  # Test number_add action
  - http_request:
      service: lotus
      method: POST
      path: /api/v1/mappings/test
      body:
        name: "Number Add Test"
        source_raw:
          price: 100
          tax: 8.5
        source_fields:
          - id: price
            path: "price"
            type: number
          - id: tax
            path: "tax"
            type: number
        target_fields:
          - id: total
            path: "total"
            type: number
        steps:
          - id: add
            type: transformer
            action:
              key: number_add
        links:
          - source:
              field_id: price
            target:
              step_id: add
          - source:
              field_id: tax
            target:
              step_id: add
          - source:
              step_id: add
            target:
              field_id: total
      expect:
        status: 200
      save_as: add_result

  # Verify the result
  - assert:
      variable: add_result.target_raw.total
      equals: 108.5
      message: Numbers should be added (100 + 8.5 = 108.5)

  # Test number_multiply action
  - http_request:
      service: lotus
      method: POST
      path: /api/v1/mappings/test
      body:
        name: "Number Multiply Test"
        source_raw:
          quantity: 5
          price: 12.99
        source_fields:
          - id: quantity
            path: "quantity"
            type: number
          - id: price
            path: "price"
            type: number
        target_fields:
          - id: subtotal
            path: "subtotal"
            type: number
        steps:
          - id: multiply
            type: transformer
            action:
              key: number_multiply
        links:
          - source:
              field_id: quantity
            target:
              step_id: multiply
          - source:
              field_id: price
            target:
              step_id: multiply
          - source:
              step_id: multiply
            target:
              field_id: subtotal
      expect:
        status: 200
      save_as: multiply_result

  # Verify the result
  - assert:
      variable: multiply_result.target_raw.subtotal
      equals: 64.95
      message: Numbers should be multiplied (5 * 12.99 = 64.95)

  # Test number_subtract action
  - http_request:
      service: lotus
      method: POST
      path: /api/v1/mappings/test
      body:
        name: "Number Subtract Test"
        source_raw:
          total: 100
          discount: 15
        source_fields:
          - id: total
            path: "total"
            type: number
          - id: discount
            path: "discount"
            type: number
        target_fields:
          - id: final_price
            path: "final_price"
            type: number
        steps:
          - id: subtract
            type: transformer
            action:
              key: number_subtract
        links:
          - source:
              field_id: total
            target:
              step_id: subtract
          - source:
              field_id: discount
            target:
              step_id: subtract
          - source:
              step_id: subtract
            target:
              field_id: final_price
      expect:
        status: 200
      save_as: subtract_result

  # Verify the subtraction result: 100 - 15 = 85
  - assert:
      variable: subtract_result.target_raw.final_price
      equals: 85
      message: Subtraction should produce 100 - 15 = 85

  # Test number_abs (absolute value)
  - http_request:
      service: lotus
      method: POST
      path: /api/v1/mappings/test
      body:
        name: "Number Absolute Test"
        source_raw:
          value: -42.5
        source_fields:
          - id: input
            path: "value"
            type: number
        target_fields:
          - id: output
            path: "result"
            type: number
        steps:
          - id: abs
            type: transformer
            action:
              key: number_abs
        links:
          - source:
              field_id: input
            target:
              step_id: abs
          - source:
              step_id: abs
            target:
              field_id: output
      expect:
        status: 200
      save_as: abs_result

  # Verify absolute value: |-42.5| = 42.5
  - assert:
      variable: abs_result.target_raw.result
      equals: 42.5
      message: Absolute value of -42.5 should be 42.5

  # Test number_round
  - http_request:
      service: lotus
      method: POST
      path: /api/v1/mappings/test
      body:
        name: "Number Round Test"
        source_raw:
          value: 42.7
        source_fields:
          - id: input
            path: "value"
            type: number
        target_fields:
          - id: output
            path: "result"
            type: number
        steps:
          - id: round
            type: transformer
            action:
              key: number_round
        links:
          - source:
              field_id: input
            target:
              step_id: round
          - source:
              step_id: round
            target:
              field_id: output
      expect:
        status: 200
      save_as: round_result

  # Verify round result: round(42.7) = 43
  - assert:
      variable: round_result.target_raw.result
      equals: 43
      message: Round of 42.7 should be 43
