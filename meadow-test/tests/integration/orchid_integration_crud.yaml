name: Orchid Integration CRUD
description: Test creating, reading, updating, and deleting Orchid integrations

steps:
  # Create an integration
  - http_request:
      service: orchid
      method: POST
      path: /api/v1/integrations
      body:
        name: "Test Integration {{uuid}}"
        description: "Integration created by meadow-test"
        config_schema:
          name: "Test Config Schema"
          schema:
            type: object
            properties:
              base_url:
                type: string
              api_key:
                type: string
            required:
              - base_url
      expect:
        status: 201
      save_as: integration_response

  # Verify the integration was created with correct data
  - assert:
      variable: integration_response.id
      not_empty: true
      message: Integration ID should be returned

  - assert:
      variable: integration_response.description
      equals: "Integration created by meadow-test"
      message: Integration description should match

  # Read the integration back
  - http_request:
      service: orchid
      method: GET
      path: /api/v1/integrations/{{integration_response.id}}
      expect:
        status: 200
      save_as: get_response

  # Verify the read response has correct values
  - assert:
      variable: get_response.id
      equals: "{{integration_response.id}}"
      message: Retrieved integration should have same ID

  - assert:
      variable: get_response.description
      equals: "Integration created by meadow-test"
      message: Retrieved integration description should match

  # Update the integration
  - http_request:
      service: orchid
      method: PUT
      path: /api/v1/integrations/{{integration_response.id}}
      body:
        name: "Updated Integration"
        description: "Updated description"
      expect:
        status: 200
      save_as: update_response

  # Verify the update was applied
  - http_request:
      service: orchid
      method: GET
      path: /api/v1/integrations/{{integration_response.id}}
      expect:
        status: 200
      save_as: updated_get_response

  - assert:
      variable: updated_get_response.description
      equals: "Updated description"
      message: Integration description should be updated

  # List integrations and verify ours is there
  - http_request:
      service: orchid
      method: GET
      path: /api/v1/integrations
      expect:
        status: 200
      save_as: list_response

  - assert:
      variable: list_response
      not_empty: true
      message: Integration list should not be empty

cleanup:
  # Delete the integration
  - http_request:
      service: orchid
      method: DELETE
      path: /api/v1/integrations/{{integration_response.id}}

